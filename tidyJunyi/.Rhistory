mutate(date = as.Date(date))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>%
ggplot(aes(x=date, y=value, colour=type)) + geom_line()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>%
ggplot(aes(x=date, y=value, colour=type)) + geom_histogram()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>%
ggplot(aes(x=date, y=value, colour=type)) + geom_line()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>%
ggplot(aes(x=date, y=value, colour=type)) + geom_line() + geom_point()
?gemo_histogram
?geom_histogram
library(ggplot2)
str(mpg)
library(dplyr)
mpg %>% ggplot(aes(x=cty, y=hwy)) %>% geom_point()
mpg %>% ggplot(mapping=aes(x=cty, y=hwy)) %>% geom_point()
?aes
p <- ggplot(data = mpg, aes(x=cty, y=hwy))
p + geom_point()
?ggplot
mpg %>% ggplot(data = mpg, aes(x=cty, y=hwy))
mpg
ggplot(data = mpg, aes(x=cty, y=hwy))
mpg %>% ggplot(aes(x=cty, y=hwy))
mpg %>% ggplot(aes(x=cty, y=hwy)) + geom_point()
mpg %>% ggplot(aes(x=cty, y=hwy)) + geom_point() %>%
summary
p <- mpg %>% ggplot(aes(x=cty, y=hwy)) + geom_point()
summary(p)
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(color = 'red4', size = 3)
mpg %>% ggplot(aes(x=cty, y=hwy, color = factor(year))) +
geom_point()
mpg %>% ggplot(aes(x=cty, y=hwy, color = factor(year))) +
geom_point() + stat_smooth()
Sys.Date()
base_monday = as.Date("2016-1-4")
(Sys.Date() - base_monday)
abs(Sys.Date() - base_monday) %% 7
as.numeric(Sys.Date() - base_monday) %% 7
base_monday = as.Date("2016-1-4")
recent_monday <- base_monday + (as.numeric(Sys.Date() - base_monday) %/% 7)*7
recent_monday
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year))) + stat_smooth()
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year))) +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4'))
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ)) +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4'))
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ,
alpha = 0.5)) +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4')) +
scale_size_continuous(range = c(4:10))
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ,
alpha = 0.5)) +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4')) +
scale_size_continuous(range = c(4,10))
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ,
alpha = 0.5,
position = 'jitter')) +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4')) +
scale_size_continuous(range = c(4,10))
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ),
alpha = 0.5,
position = 'jitter') +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4')) +
scale_size_continuous(range = c(4,10))
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ),
alpha = 0.5,
position = 'jitter') +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4')) +
scale_size_continuous(range = c(4,10)) + coord_polar
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ),
alpha = 0.5,
position = 'jitter') +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4')) +
scale_size_continuous(range = c(4,10)) + coord_polar()
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ),
alpha = 0.5,
position = 'jitter') +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4')) +
scale_size_continuous(range = c(4,10)) +
coord_cartesian() +
facet_wrap(~ year, ncol = 1)
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ),
alpha = 0.5,
position = 'jitter') +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4')) +
scale_size_continuous(range = c(4,10)) +
coord_cartesian() +
facet_wrap(year, ncol = 1)
~ year
mpg %>% ggplot(aes(x=cty, y=hwy)) +
geom_point(aes(color = factor(year),
size = displ),
alpha = 0.5,
position = 'jitter') +
stat_smooth() +
scale_color_manual(values = c('steelblue','red4')) +
scale_size_continuous(range = c(4,10)) +
coord_cartesian() +
facet_wrap(~ year, ncol = 1)
?facet_wrap()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(month = str_extract_all(date,'-\\d\\d-'))
library(stringr)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(month = str_extract_all(date,'-\\d\\d-'))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(month = str_extract_all(date,'-\\d\\d-')[[1]])
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d')[[1]]) %>%
group_by(ym, type) %>% summarize(value = sum(value))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d')[[1]]) %>%
group_by(ym) %>% summarize(value = sum(value))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d')[[1]])
View(teacher_sample_log)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(value = sum(value))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value))
ggplot(aes(x=date, color=type)) + geom_bar()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value))
ggplot(aes(x=date, fill=type)) + geom_bar()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=date, fill=type)) + geom_bar()
view(mpg)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=ym, fill=type)) + geom_bar()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=ym, fill=type, y = value)) + geom_bar()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=ym, y=value, group=type, fill=type)) + geom_area()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>%
gather(type, value, video, prob) %>% mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(video = sum(video),
prob = sum(prob))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob))
##prob, video timeseries
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob)) %>% mutate(video_prop = video/(video+prob),
prob_prop = prob/(video+prob))
?gather
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob)) %>% mutate(video_prop = video/(video+prob),
prob_prop = prob/(video+prob)) %>%
gather(ym, prop, video_prop, prob_prop)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob)) %>% mutate(video_prop = video/(video+prob),
prob_prop = prob/(video+prob))
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob)) %>% mutate(video_prop = video/(video+prob),
prob_prop = prob/(video+prob))  %>% View
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob)) %>% mutate(video_prop = video/(video+prob),
prob_prop = prob/(video+prob)) %>%
gather(ym, type, video_prop, prob_prop)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob)) %>% mutate(video_prop = video/(video+prob),
prob_prop = prob/(video+prob))  %>% View
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob)) %>% mutate(video_prop = video/(video+prob),
prob_prop = prob/(video+prob)) %>%
gather(date, type, video_prop, prob_prop)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob)) %>% mutate(video_prop = video/(video+prob),
prob_prop = prob/(video+prob)) %>%
gather(type, value, video_prop, prob_prop)
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(ym = date %>% str_extract_all('\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym) %>% summarize(video = sum(video),
prob = sum(prob)) %>% mutate(video_prop = video/(video+prob),
prob_prop = prob/(video+prob)) %>%
gather(type, value, video_prop, prob_prop) %>%
ggplot(aes(x=ym, y=value, group=type, fill=type)) + geom_area()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>% gather(type, value, video, prob) %>%
mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=ym, y=value, group=type, fill=type)) + geom_area()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>% gather(type, value, video, prob) %>%
mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=ym, y=value, group=type, fill=type),
alpha = 0.5) + geom_area()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>% gather(type, value, video, prob) %>%
mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=ym, y=value, group=type, fill=type, alpha = 0.5)) + geom_area()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>% gather(type, value, video, prob) %>%
mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=ym, y=value, group=type, fill=type),
alpha = 0.5) + geom_line()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>% gather(type, value, video, prob) %>%
mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=ym, y=value, color=type)) + geom_line()
teacher_sample_log %>% distinct(eventID, eventType, date) %>% mutate(video = ifelse(eventType == 'video',1,0),
prob = ifelse(eventType == 'prob',1,0)) %>%
group_by(date) %>% summarise(video = sum(video), prob = sum(prob)) %>%
mutate(date = as.Date(date)) %>% gather(type, value, video, prob) %>%
mutate(ym = str_extract_all(date,'\\d\\d\\d\\d-\\d\\d') %>% unlist) %>%
group_by(ym, type) %>% summarize(value = sum(value)) %>%
ggplot(aes(x=ym, y=value, color=type, group = type)) + geom_line()
C
?c
?C
class("SELECT")
devtools::document()
library(tidyJunyi)
recent_monday
base_monday = as.Date("2016-1-4")
recent_monday <- base_monday + (as.numeric(Sys.Date() - base_monday) %/% 7)*7
dataset.date = as.character(recent_monday)
dataset.date
?version()
packageVersion("snow")
packageVersion("tidyJunyi")
devtools::document()
library(tidyJunyi)
packageVersion("tidyJunyi")
as.numeric(packageVersion("tidyJunyi"))
str(packageVersion("tidyJunyi"))
as.character(packageVersion("tidyJunyi"))
as.numeric(as.character(packageVersion("tidyJunyi")))
library(tidyJunyi) #must use version > 0.3
if(as.numeric(as.character(packageVersion("tidyJunyi"))) < 0.3){
stop("please upgrade tidyJunyi package to version 0.3 or above")
}#end if
library(tidyJunyi) #must use version > 0.3
library(dplyr)
if(as.numeric(as.character(packageVersion("tidyJunyi"))) < 0.3){
stop("please upgrade tidyJunyi package to version 0.3 or above")
}#end if
##global settings
watch_days = 365*1.5
base_monday = as.Date("2016-1-4")
recent_monday <- base_monday + (as.numeric(Sys.Date() - base_monday) %/% 7)*7
dataset.date = as.character(recent_monday)
set_dataset(dataset.date,"tmp_tidy")
usertbl <- tbl_info_User()
ts_coach <- tbl_relation_users_TS_byCoach()
ts_class <- tbl_relation_users_TS_byClass()
videoprob <- tbl_log_VideoProb()
colnames(videoprob)
videoprob  %>% table(eventID)
videoprob  %>% table(eventID)  %>% view
?tail
?table
?contains
videoprob  %>% select(contains(X1TgztLfo_Q))  %>% view
videoprob  %>% select(contains("X1TgztLfo_Q"))  %>% view
colnames(videoprob)
videoprob  %>% select(contains("da"))  %>% view
show_query(videoprob %>% filter(abs(datediff(timestamp(date), timestamp(Sys.date()))) < watch_days,
semester_stable == 'stable'))
show_query(videoprob %>% filter(abs(datediff(timestamp(date), timestamp(Sys.date()))) < Inf,
semester_stable == 'stable'))
?gather
devtools::document()
library(tidyJunyi)
show_query(videoprob %>% filter(abs(datediff(timestamp(date), timestamp(Sys.date()))) < watch_days,
isTANET == T,
semester_stable == 'stable') %>%
group_by(user_primary_key, year, session_type) %>%
summarize(use_month = n_distinct(month)) %>%
##
mutate(full_semester1_use = IF(session_type == 'semester1' & use_month == 3,1,0),
full_semester2_use = IF(session_type == 'semester2' & use_month == 3,1,0)) %>%
mutate(full_semester_use = full_semester1_use + full_semester2_use) %>%
##
group_by(user_primary_key, year) %>%
summarize(yearly_semester_use = sum(full_semester_use)) %>%
filter(yearly_semester_use > 0))
options(stringsAsFactors = F)
library(dplyr)
setwd("/Users/peishenwu/Google 雲端硬碟/【01】醫學/PMR/R3/主任研究/20170111")
inputdata <- read.csv("Hyoid_pin-test 20170109.csv", encoding = "utf8") %>% filter(name != "")
View(inputdata)
#library(devtools)
#library(gtools)
#ID = ask("ID?"); PWD = ask("password?");
#install_bitbucket("peishenwu/rportal",auth_user = ID,password = PWD)
source("/Users/peishenwu/Google 雲端硬碟/【01】醫學/PMR/R3/Rportal_package/credentials.R")
##
library(Rportal)
sID <- p_login(ID,PWD)
today <- Sys.Date()
yr = substr(today,1,4)
mon = substr(today,6,7)
day = substr(today,9,10)
test <- p_listConsult(sID,"PMR",yr,mon,as.numeric(day)-2,yr,mon,day)
test2 <- test
test2 <- test2[!grepl("西址",test2$type),]
test2 <- test2[!(test2$status %in% c("暫存","刪除")),]
test2$remainTime[test2$remainTime == "-"] <- NA
test2 <- test2[(as.numeric(substr(test2$remainTime,1,2)) < 24)
| (is.na(test2$remainTime)
& abs(as.Date(gsub("\\d\\d:\\d\\d","",test2$consult.time))-today)==0),]
View(test2[complete.cases(test2$chartNo),])
#library(devtools)
#library(gtools)
#ID = ask("ID?"); PWD = ask("password?");
#install_bitbucket("peishenwu/rportal",auth_user = ID,password = PWD)
source("/Users/peishenwu/Google 雲端硬碟/【01】醫學/PMR/R3/Rportal_package/credentials.R")
##
library(Rportal)
sID <- p_login(ID,PWD)
today <- Sys.Date()
yr = substr(today,1,4)
mon = substr(today,6,7)
day = substr(today,9,10)
test <- p_listConsult(sID,"PMR",yr,mon,as.numeric(day)-2,yr,mon,day)
test2 <- test
test2 <- test2[!grepl("西址",test2$type),]
test2 <- test2[!(test2$status %in% c("暫存","刪除")),]
test2$remainTime[test2$remainTime == "-"] <- NA
test2 <- test2[(as.numeric(substr(test2$remainTime,1,2)) < 24)
| (is.na(test2$remainTime)
& abs(as.Date(gsub("\\d\\d:\\d\\d","",test2$consult.time))-today)==0),]
View(test2[complete.cases(test2$chartNo),])
View(test)
View(test2)
